{% extends "base.html" %}

{% block content %}
<div class="section-header mb-4 fade-in">
    <div>
        <h1 class="mb-2 display-4">Selamat Datang di Gloria Komputer</h1>
        <p class="lead mb-0 text-muted">Kelola inventaris komponen dan aksesoris komputer Anda dengan efisien.</p>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-3">
        <div class="card stat-card h-100 hover-lift">
            <div class="card-body">
                <div class="row">
                    <div class="col">                        <h6 class="text-muted mb-2">Total Produk</h6>
                        <span class="h3 mb-0 counter-value" data-value="{{ total_products }}">{{ total_products }}</span>
                    </div>
                    <div class="col-auto">
                        <div class="icon-wrapper bg-primary-soft">
                            <i class="bi bi-box text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card h-100 hover-lift">
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <h6 class="text-muted mb-2">Stok Menipis</h6>
                        <span class="h3 mb-0 counter-value">{{ low_stock }}</span>
                    </div>
                    <div class="col-auto">
                        <div class="icon-wrapper bg-warning-soft">
                            <i class="bi bi-exclamation-triangle text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card h-100 hover-lift">
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <h6 class="text-muted mb-2">Kategori</h6>
                        <span class="h3 mb-0 counter-value">{{ categories }}</span>
                    </div>
                    <div class="col-auto">
                        <div class="icon-wrapper bg-info-soft">
                            <i class="bi bi-tags text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card h-100 hover-lift">
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <h6 class="text-muted mb-2">Pending Restock</h6>
                        <span class="h3 mb-0 counter-value">{{ pending_restocks }}</span>
                    </div>
                    <div class="col-auto">
                        <div class="icon-wrapper bg-success-soft">
                            <i class="bi bi-cart-plus text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if low_stock_items %}
<div class="row mt-5 fade-in">
    <div class="col-12">
        <div class="card hover-shadow">
            <div class="card-header bg-warning-soft">
                <h5 class="card-title mb-0">
                    <i class="bi bi-exclamation-triangle me-2"></i>Peringatan Stok Menipis
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Nama Produk</th>
                                <th>Kategori</th>
                                <th>Stok Tersedia</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in low_stock_items %}
                            <tr>
                                <td>{{ item.product_name }}</td>
                                <td>{{ item.category }}</td>
                                <td>
                                    <span class="badge bg-danger">{{ item.quantity }}</span>
                                </td>
                                <td>
                                    <a href="{{ url_for('restock.add_restock') }}" class="btn btn-sm btn-primary">
                                        <i class="bi bi-cart-plus"></i> Restock
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const counterElements = document.querySelectorAll('.counter-value');
    counterElements.forEach(counter => {
        // Store the original value
        const originalValue = counter.textContent;
        if (isNaN(parseInt(originalValue))) return;
        
        const updateCounter = () => {
            const target = parseInt(originalValue);
            const current = parseInt(counter.textContent);
            const increment = Math.ceil(target / 20);
            
            if (current < target) {
                counter.textContent = Math.min(current + increment, target);
                requestAnimationFrame(updateCounter);
            }
        };
        
        // Start from 0
        counter.textContent = '0';
        // Begin animation
        requestAnimationFrame(updateCounter);
    });
});
</script>
{% endblock %}
{% endblock %}
